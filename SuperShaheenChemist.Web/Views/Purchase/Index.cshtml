
@{
    ViewBag.Title = "Purchase";
}

<h2>Purchase</h2>


<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/themes/start/jquery-ui.css"></script>
<script src="~/Client/plugins/jquery-validation/jquery.validate.min.js"></script>
<div class="content-wrapper">
    <!-- pages navigates here -->
    <section class="content">

        <div class="row">
            <div class="col-xs-12 col-md-12 col-sm-12">
                <div class="box">
                    <div class="box-body ">
                        <h4 class="purchase-heading"> <i class="fa fa-check-circle"></i> Create Purchase Items</h4>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Distributor:</label>
                                    <input type="text" name="ProductName" value="" class="form-control input-lg" placeholder="e.g Panadol" reqiured="" />
                                </div>
                                <small>Name of the medicine or product ? </small>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Bill No</label>
                                    <input type="text" name="GenericName" value="" class="form-control input-lg" placeholder="e.g Paracetamol" reqiured="" />
                                </div>
                                <small>Name of the product ? </small>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Upload Bill Image</label>
                                    <input type="text" name="BatchNo" value="" class="form-control input-lg" placeholder="e.g Batch No" reqiured="" />
                                </div>
                                <small>Sku or Batch No ?  </small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="form-group">
                                    <label><i class="fa fa-search" aria-hidden="true"></i> <b>SEARCH ITEMS :</b></label>
                                    <select name="search_area" class="form-control input-lg" id="barcode_scan_area" style="width: 100%;">
                                    </select>
                                    <input type="text" id="searchProduct" placeholder="Search Product By Name Or BarCode" class="form-control clearable" />
                                    <small>Search through product name or Barcode </small> <br />
                                    <small style="color:#c00;">Note : After changing MRP press enter to apply values. </small>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <table class="table" id="purchaseItems">
                                        <thead class="">
                                            <tr>
                                                <th>Product Name</th>
                                                <th>Generic Name</th>
                                                <th>Quantity</th>
                                                <th>Price</th>
                                                <th>Amount</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>
        
    </section>
</div>

<script>
    $(document).ready(function () {

        $('#searchProduct').hide();
        $('#barcode_scan_area').click(function () {
            if ($('#searchProduct').is(":hidden")) {
                $('#searchProduct').show();
                $('#searchProduct').focus();
            }

            else { 
                $('#searchProduct').hide();
                $('#searchProduct').blur();
                
             }
             //$('#searchProduct').hide();
            
        }
        );
        $('#searchProduct').autocomplete({
            source: function (request, response) {

                $.ajax({
                    url: "/purchase/GetProductList",
                    type: "GET",
                    dataType: 'JSON',
                    selectFirst: true,
                    data: { productName: request.term },
                    success: function (data) {
                        //alert(JSON.stringify(data));
                        response($.map(data, function (item) {
                            return { label: item.ProductName, value: item.productID }
                        }));
                        //response($.map(data, function () { }));
                    }

                });
            },
            select: function (event, ui) {
                event.preventDefault();
                //$('#searchProduct').val('');
                //$('#searchProduct').hide();
                //$('#barcode_scan_area').val(ui.item.value);
                $('#searchProduct').val('');
                $('#barcode_scan_area').focus();
                $('#searchProduct').css("display", "none");
                $("#barcode_scan_area").append('<option value="' + ui.item.value + '">' + ui.item.label + '</option>');
                $product_id = ui.item.value;
                addRecordToTable($product_id);
                
            },
            focus: function (event, ui) {
                //event.preventDefault();
                //$('input[name="user-name"]').val(ui.item.label);
                return false;
            }
        });
        function addRecordToTable(productid) {
            $.ajax({
                url: "/purchase/getProduct",
                type: "GET",
                dataType: 'JSON',
                data: { productId: productid },
                success: function (data) {
                    //alert(JSON.stringify(data));
                    $("#purchaseItems").append('<tr class="rowSelector" style="background-color: white;"><td>' + data.ProductName + '</td><td>'
                        + data.GenericName + '</td><td><input id="qunatity" type="number"/></td><td>' + data.PackCost + '</td><td id="amount">0</td><tr>');
                    $("#barcode_scan_area").empty();
                }
            });
            
        }
        $('#purchaseItems').on('change', '.rowSelector', function () {
            
            //alert($(this).find('td:eq(3)').text());
            var input = $(this).find('input').val();
            var value = $(this).find('td:eq(3)').text();
            $(this).find('td:eq(4)').html(input * value);


        });


    });

</script>
